#:import to_rgba kivy.utils.get_color_from_hex
#:import Logger kivy.logger.Logger
#:import random random.random


<Player>:
    name: "player"
    icon: "data/icons/easter_egg.png" if random() < 0.01 else "data/icons/player_alive.png"
    number: 0
    strategic_value: 0
#    borders: 2, "solid", to_rgba("F5F5F5")
    mafia: False
    alive: True
#    on_alive: root.ready_action("die")
    # The second layer in this dictionary is REQUIRED. Shallow copy dragons will get angry if you flatten this dict. Hiss.
    actions: {"accuse": {'player': None}, "suspect": {'player': None}, "vote": {'decision': "abstain"}}
    current_action: "accuse"
    on_current_action: self.borders = (2, "solid", to_rgba("05F5F5")); self.update_borders()
    orientation: "vertical"


<DiscussionPlayer>:
    drop_widget: dropdown.__self__

    FloatLayout:
        id: empty
        height: "0dp"
        size_hint_y: 0

    ImageButton:
        disabled: not root.alive
        source: root.icon
        on_release:
#             if app.root.current_screen.selected_player: app.root.current_screen.selected_player.icon = "data/icons/player_alive.png"
#             print(app.root.current_screen.selected_player)
#             app.root.current_screen.selected_player = root
#             root.icon = "data/icons/player_alive_old.png"
            dropdown.open(self)
            # print(app.root.current_screen.players)
            # root.show_bubble()
            if app.root.current_screen.selected_player: app.root.current_screen.selected_player.act_on(root.__self__); app.root.current_screen.selected_player = None

    DropDown:
        disabled: not root.alive
        id: dropdown
        on_select:
            Logger.info('{}'.format(args[1]))

        Button:
            text: 'Accuse'
            size_hint_y: None
            height: '48dp'
            on_release:
                root.ready_action('Accuse')
                dropdown.select('Ready to accuse another player')

        Button:
            text: 'Suspect'
            color: to_rgba("050505")
            size_hint_y: None
            height: '48dp'
            on_release:
                root.ready_action('Suspect')
                dropdown.select('Ready to suspect another player')

        Button:
            text: 'Abstain'
            size_hint_y: None
            height: '48dp'
            on_release:
                root.ready_action('Abstain')
                dropdown.select('Abstaining from the vote')

<NightSleepingPlayer>:
    Image:
        source: root.icon
    Button:
        disabled: not root.alive
        text: "Kill"
        color: to_rgba("F5F5F5")
        background_color: to_rgba("212121")
        on_press: app.root.current_screen.selected_player = root.__self__

<TrialPlayer>:
#    borders: 2, "solid", to_rgba("F44336")
    ImageButton:
        disabled: not root.alive
        source: root.icon
        on_press:
            if app.root.current_screen.selected_player: app.root.current_screen.selected_player.act_on(root); app.root.current_screen.selected_player = None
    Spinner:
        disabled: not root.alive
        text: "Abstain"
        color: to_rgba("F5F5F5")
        background_color: to_rgba("212121")
        values: "Abstain", "Innocent", "Guilty"
        on_text: root.ready_action(self.text)

<PlayerIcon>:
    Image:
        source: root.icon

<DeadPlayer>:
    Image:
        source: root.icon
