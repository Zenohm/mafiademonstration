#:import to_rgba kivy.utils.get_color_from_hex
#:import Logger kivy.logger.Logger
#:import random random.random


<Player>:
    orientation: "vertical"
    icon: "data/icons/easter_egg.png" if random() < 0.01 else "data/icons/player_alive.png"
    # The second layer in this dictionary is REQUIRED. Shallow copy dragons will get angry if you flatten this dict. Hiss.
    actions: {"accuse": {"player": None}, "suspect": {"player": None}, "vote": {"decision": "abstain"}}
    current_action: "abstain"
    on_current_action: self.borders = (2, "solid", to_rgba("05F5F5")); self.update_borders()


<DiscussionPlayer>:
    drop_widget: dropdown.__self__

    FloatLayout:
        id: empty
        height: "0dp"
        size_hint_y: 0

    ImageButton:
        source: root.icon
        disabled: not root.alive
        on_release:
#             if app.root.current_screen.selected_player: app.root.current_screen.selected_player.icon = "data/icons/player_alive.png"
#             print(app.root.current_screen.selected_player)
#             app.root.current_screen.selected_player = root
#             root.icon = "data/icons/player_alive_old.png"
            dropdown.open(self)
            # print(app.root.current_screen.players)
            # root.show_bubble()
            if app.root.current_screen.selected_player: app.root.current_screen.selected_player.act_on(root.__self__); app.root.current_screen.selected_player = None

    DropDown:
        id: dropdown
        disabled: not root.alive
        on_select:
            Logger.info("{}".format(args[1]))

        Button:
            text: "Accuse"
            size_hint_y: None
            height: "48dp"
            on_release:
                root.ready_action("Accuse")
                dropdown.select("Ready to accuse another player")

        Button:
            text: "Suspect"
            color: to_rgba("050505")
            size_hint_y: None
            height: "48dp"
            on_release:
                root.ready_action("Suspect")
                dropdown.select("Ready to suspect another player")

        Button:
            text: "Abstain"
            size_hint_y: None
            height: "48dp"
            on_release:
                root.ready_action("Abstain")
                dropdown.select("Abstaining from the vote")

<NightSleepingPlayer>:
    Image:
        source: root.icon
    Button:
        text: "Kill"
        color: to_rgba("F5F5F5")
        background_color: to_rgba("212121")
        disabled: not root.alive
        on_press: app.root.current_screen.selected_player = root.__self__

<TrialPlayer>:
    ImageButton:
        source: root.icon
        disabled: not root.alive
        on_press:
            if app.root.current_screen.selected_player: app.root.current_screen.selected_player.act_on(root)
            app.root.current_screen.selected_player = None
    Spinner:
        text: "Abstain"
        color: to_rgba("F5F5F5")
        background_color: to_rgba("212121")
        values: "Abstain", "Innocent", "Guilty"
        disabled: not root.alive
        on_text: root.ready_action(self.text)

<PlayerIcon>:
    Image:
        source: root.icon

<DeadPlayer>:
    Image:
        source: root.icon
